<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mini O‚Äòyin - Silliq versiya</title>
<style>
body { text-align:center; background:#f0f0f0; margin:0; padding:0; font-family:sans-serif; user-select:none;}
canvas { background:lightblue; border:2px solid black; display:none; margin:auto; width:100%; max-width:500px; height:auto;}
button { font-size:20px; margin:5px; padding:10px 20px;}
h2{margin:10px;}
#characterSelect {margin-top:20px;}
#characters img {width:80px; margin:10px; cursor:pointer; border-radius:10px; transition: transform 0.2s, border 0.2s;}
#characters img:hover {transform:scale(1.1);}
#selectedName {font-weight:bold; margin:10px; font-size:18px;}
#gameOver {font-size:24px; color:red; margin-top:10px; display:none;}
</style>
</head>
<body>

<h2>üéÆ Mini O‚Äòyin</h2>
<p>Ball: <span id="score">0</span> | HP: <span id="hp">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></p>
<div id="gameOver"></div>

<div id="startScreen">
  <button id="start-btn">‚ñ∂Ô∏è Play</button>
</div>

<div id="characterSelect">
  <h3>Qahramon tanla</h3>
  <div id="characters">
    <img src="https://i.postimg.cc/dZy1d1pQ/image.png" alt="utkpower" onclick="selectCharacter('https://i.postimg.cc/dZy1d1pQ/image.png','Utkpower', event)">
    <img src="https://i.postimg.cc/dtt7Ndw5/image.png" alt="New utkpower" onclick="selectCharacter('https://i.postimg.cc/dtt7Ndw5/image.png','New Utkpower', event)">
    <img src="https://i.postimg.cc/4yMT1rJn/image.png" alt="Brother Tora" onclick="selectCharacter('https://i.postimg.cc/4yMT1rJn/image.png','Brother Tora', event)">
    <img src="https://i.postimg.cc/W4Wj3DQk/image.png" alt="RTXPower" onclick="selectCharacter('https://i.postimg.cc/W4Wj3DQk/image.png','RTXPower', event)">
    <img src="https://i.postimg.cc/7P78vQYL/image.png" alt="Ong Bak" onclick="selectCharacter('https://i.postimg.cc/7P78vQYL/image.png', 'Ong Bak', event)">
    <img src="https://i.postimg.cc/XvZ1fprX/image.png" alt="Hakimbek" onclick="selectCharacter('https://i.postimg.cc/XvZ1fprX/image.png', 'Hakimbek', event)">
    <img src="https://i.postimg.cc/2St2Sr05/image.png" alt="Umid Boxer" onclick="selectCharacter('https://i.postimg.cc/2St2Sr05/image.png', 'Umid Boxer', event)">
  </div>
  <p id="selectedName"></p>
</div>

<canvas id="gameCanvas" width="500" height="300"></canvas>
<div id="controls" style="display:none;"><button onclick="jump()">‚¨ÜÔ∏è Sakrash</button></div>

<script>
const canvas=document.getElementById("gameCanvas"), ctx=canvas.getContext("2d");
const scoreEl=document.getElementById("score"), hpEl=document.getElementById("hp"), gameOverEl=document.getElementById("gameOver");
let selectedCharacter=null;

function selectCharacter(img,name,event){
  event.preventDefault();
  selectedCharacter=img;
  document.querySelectorAll('#characters img').forEach(i=>i.style.border='');
  event.target.style.border='3px solid blue';
  document.getElementById("selectedName").innerText="Tanlangan qahramon: "+name;
}

// AUDIO (jump va coin yo‚Äòq)
const bgMusic=new Audio('https://erdashev1337-hub.github.io/Gandon-Game/Music/bg-music.mp3');
bgMusic.loop=true; bgMusic.volume=0.4;
const gameOverSound=new Audio('https://erdashev1337-hub.github.io/Gandon-Game/Music/game-over.mp3');

document.getElementById('start-btn').addEventListener('click', ()=>{
  if(!selectedCharacter){alert("Iltimos, qahramonni tanlang!"); return;}
  document.getElementById('startScreen').style.display='none';
  document.getElementById('characterSelect').style.display='none';
  canvas.style.display='block';
  document.getElementById('controls').style.display='block';
  bgMusic.play().catch(e=>console.log(e));
  startGame();
});

let score=0,hp=5,groundHeight=50;
let coins=[], obstacles=[], maxObjects=8, gameSpeed=3, frameCount=0;
const playerImg=new Image();

let player={
  x:50,y:220,width:50,height:50,
  dy:0,
  gravity:0.6,
  jumpPower:-10,   // default
  grounded:false
};

function startGame(){
  playerImg.src=selectedCharacter;

  // üü¶ Faqat Utkpower uchun kuchli sakrash
  if (selectedCharacter.includes("dZy1d1pQ")) { 
      player.jumpPower = -14; 
  }

  updateHP();
  update();
}

function updateHP(){ hpEl.innerText="‚ù§Ô∏è".repeat(hp); }

function drawPlayer(){ ctx.drawImage(playerImg,player.x,player.y,player.width,player.height); }

function drawGround(){ ctx.fillStyle="green"; ctx.fillRect(0,canvas.height-groundHeight,canvas.width,groundHeight); }

function drawCoins(){
  ctx.fillStyle="gold";
  coins.forEach(c=>{
    if(!c.collected && c.x>0 && c.x<canvas.width+20){
      ctx.beginPath(); ctx.arc(c.x,c.y,c.radius,0,Math.PI*2); ctx.fill();
    }
  });
}

function drawObstacles(){
  obstacles.forEach(o=>{
    if(o.x+o.width>0){
      if(o.type==="spike"){
        ctx.fillStyle="gray";
        ctx.beginPath();
        ctx.moveTo(o.x,o.y+o.height);
        ctx.lineTo(o.x+o.width/2,o.y);
        ctx.lineTo(o.x+o.width,o.y+o.height);
        ctx.closePath();
        ctx.fill();
      } else {
        ctx.fillStyle="brown";
        ctx.fillRect(o.x,o.y,o.width,o.height);
      }
    }
  });
}

function checkCollisions(){
  coins.forEach(c=>{
    if(!c.collected && Math.abs(player.x-c.x)<100){
      let dx=(player.x+player.width/2)-c.x;
      let dy=(player.y+player.height/2)-c.y;
      if(Math.sqrt(dx*dx+dy*dy)<player.width/2+c.radius){
        c.collected=true;
        score++;
        scoreEl.innerText=score;
      }
    }
  });

  obstacles.forEach(o=>{
    if(o.type==="spike" &&
       Math.abs(player.x-o.x)<100 &&
       player.x<o.x+o.width &&
       player.x+player.width>o.x &&
       player.y<o.y+o.height &&
       player.y+player.height>o.y){

      hp--;
      updateHP();
      obstacles = obstacles.filter(x=>x!==o);

      if(hp<=0){
        bgMusic.pause();
        gameOverSound.play();
        gameOverEl.innerText="‚ùå O‚Äòyin tugadi! Ball: "+score;
        gameOverEl.style.display='block';
      }
    }
  });

  player.grounded = player.y+player.height >= canvas.height-groundHeight;
}

function update(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawGround();
  drawCoins();
  drawObstacles();
  drawPlayer();
  checkCollisions();

  player.y += player.dy;
  player.dy += player.gravity;

  if(player.y+player.height >= canvas.height-groundHeight){
    player.y = canvas.height-groundHeight-player.height;
    player.dy = 0;
    player.grounded = true;
  }

  coins.forEach(c=>c.x -= gameSpeed);
  obstacles.forEach(o=>o.x -= gameSpeed);

  coins = coins.filter(c=>c.x>-20);
  obstacles = obstacles.filter(o=>o.x>-60);

  frameCount++;

  if(frameCount%120===0 && coins.length<maxObjects){
    let y=canvas.height-groundHeight-(Math.random()*60+40);
    coins.push({x:canvas.width+20,y:y,radius:10,collected:false});
  }

  if(frameCount%200===0 && obstacles.length<maxObjects){
    let h=Math.random()*15+15;
    obstacles.push({type:"spike",x:canvas.width+50,y:canvas.height-groundHeight-h,width:15,height:h});
  }

  if(hp>0) requestAnimationFrame(update);
}

function jump(){
  if(player.grounded){
    player.dy = player.jumpPower;
    player.grounded = false;
  }
}
</script>
</body>
</html>
