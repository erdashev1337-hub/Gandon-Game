<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>Mini O‚Äòyin</title>
  <style>
    body { 
      text-align: center; 
      background: #f0f0f0; 
      margin: 0; 
      padding: 0;
      font-family: sans-serif;
      -webkit-user-select: none;
      user-select: none;
    }
    canvas { 
      background: lightblue; 
      border: 2px solid black; 
      display: block; 
      margin: auto; 
      width: 100%;
      max-width: 500px;
      height: auto;
    }
    button { 
      font-size: 20px; 
      margin: 5px; 
      padding: 10px 20px; 
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    h2 { margin: 10px; }
    
    #characterSelect {
      text-align: center;
      margin-top: 20px;
    }
    #characters img {
      width: 80px;
      margin: 10px;
      cursor: pointer;
      border-radius: 10px;
      transition: transform 0.2s, border 0.2s;
    }
    #characters img:hover {
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <h2>üéÆ Mini O‚Äòyin</h2>
  <p>Ball: <span id="score">0</span> | HP: <span id="hp">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</span></p>

  <!-- Play tugmasi -->
  <div id="startScreen">
    <button id="start-btn">‚ñ∂Ô∏è Play</button>
  </div>

  <div id="characterSelect">
    <h2>Qahramon tanla</h2>
    <div id="characters">
      <img src="https://i.postimg.cc/dZy1d1pQ/image.png" alt="utkpower" onclick="selectCharacter('https://i.postimg.cc/dZy1d1pQ/image.png')">
      <img src="https://i.postimg.cc/dtt7Ndw5/image.png" alt="New utkpower" onclick="selectCharacter('https://i.postimg.cc/dtt7Ndw5/image.png')">
      <img src="https://i.postimg.cc/4yMT1rJn/image.png" alt="Brother Tora" onclick="selectCharacter('https://i.postimg.cc/4yMT1rJn/image.png')">
      <img src="https://i.postimg.cc/W4Wj3DQk/image.png" alt="rtxpower" onclick="selectCharacter('https://i.postimg.cc/W4Wj3DQk/image.png')">
      <img src="https://i.postimg.cc/7P78vQYL/image.png" alt="Ong Bak" onclick="selectCharacter('https://i.postimg.cc/7P78vQYL/image.png')">
      <img src="https://i.postimg.cc/XvZ1fprX/image.png" alt="Hakimbek" onclick="selectCharacter('https://i.postimg.cc/XvZ1fprX/image.png')">
      <img src="https://i.postimg.cc/2St2Sr05/image.png" alt="Umid Boxer" onclick="selectCharacter('https://i.postimg.cc/2St2Sr05/image.png')">
    </div>
    <button id="start-btn">Boshlash</button>
  </div>

  <canvas id="gameCanvas" width="500" height="300" style="display:none;"></canvas>

  <div id="controls" style="display:none;">
    <button onclick="jump()">‚¨ÜÔ∏è Sakrash</button>
  </div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreEl = document.getElementById("score");
    const hpEl = document.getElementById("hp");

    const playerImg = new Image();
    playerImg.src = "https://i.postimg.cc/dZy1d1pQ/image.png";

    let score = 0;
    let hp = 5;

    let player = {
      x: 50,
      y: 220,
      width: 50,
      height: 50,
      dy: 0,
      gravity: 0.6,
      jumpPower: -10,
      grounded: false
    };

    let groundHeight = 50;
    let coins = [];
    let obstacles = [];
    let gameSpeed = 3;
    let frameCount = 0;
    let gameStarted = false;

    // üéµ Sound fayllari
    const bgMusic = new Audio('https://erdashev1337-hub.github.io/Music/bg-music.mp3');
    bgMusic.loop = true;
    bgMusic.volume = 0.5;

    const gameOverSound = new Audio('game-over.mp3'); // o‚Äòzing papkaga qo‚Äòy
    const jumpSound = new Audio('jump.mp3'); // o‚Äòzing papkaga qo‚Äòy
    const coinSound = new Audio('coin.mp3'); // o‚Äòzing papkaga qo‚Äòy

    function drawPlayer() {
      ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);
    }

    function drawGround() {
      ctx.fillStyle = "green";
      ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);
    }

    function drawCoins() {
      coins.forEach(coin => {
        if (!coin.collected) {
          ctx.fillStyle = "gold";
          ctx.beginPath();
          ctx.arc(coin.x, coin.y, coin.radius, 0, Math.PI * 2);
          ctx.fill();
        }
      });
    }

    function drawObstacles() {
      obstacles.forEach(obs => {
        if (obs.type === "spike") {
          ctx.fillStyle = "gray";
          ctx.beginPath();
          ctx.moveTo(obs.x, obs.y + obs.height);
          ctx.lineTo(obs.x + obs.width / 2, obs.y);
          ctx.lineTo(obs.x + obs.width, obs.y + obs.height);
          ctx.closePath();
          ctx.fill();
        } else if (obs.type === "platform") {
          ctx.fillStyle = "brown";
          ctx.fillRect(obs.x, obs.y, obs.width, obs.height);
        }
      });
    }

    function updateHP() {
      hpEl.innerText = "‚ù§Ô∏è".repeat(hp);
    }

    function checkCollisions() {
      let onPlatform = false;

      coins.forEach(coin => {
        if (!coin.collected) {
          let dx = (player.x + player.width/2) - coin.x;
          let dy = (player.y + player.height/2) - coin.y;
          let distance = Math.sqrt(dx*dx + dy*dy);
          if (distance < player.width/2 + coin.radius) {
            coin.collected = true;
            score++;
            scoreEl.innerText = score;
            coinSound.currentTime = 0;
            coinSound.play();
          }
        }
      });

      obstacles.forEach(obs => {
        if (obs.type === "spike") {
          if (
            player.x < obs.x + obs.width &&
            player.x + player.width > obs.x &&
            player.y < obs.y + obs.height &&
            player.y + player.height > obs.y
          ) {
            hp--;
            updateHP();
            obstacles = obstacles.filter(o => o !== obs);
            if (hp <= 0) {
              bgMusic.pause();
              gameOverSound.play();
              alert("‚ùå O‚Äòyin tugadi! Ball: " + score);
              document.location.reload();
            }
          }
        } else if (obs.type === "platform") {
          if (
            player.x < obs.x + obs.width &&
            player.x + player.width > obs.x &&
            player.y + player.height <= obs.y + 10 &&
            player.y + player.height + player.dy >= obs.y
          ) {
            player.y = obs.y - player.height;
            player.dy = 0;
            onPlatform = true;
          }
        }
      });

      player.grounded = player.y + player.height >= canvas.height - groundHeight || onPlatform;
    }

    function update() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawGround();

      player.y += player.dy;
      player.dy += player.gravity;

      if (player.y + player.height >= canvas.height - groundHeight) {
        player.y = canvas.height - groundHeight - player.height;
        player.dy = 0;
        player.grounded = true;
      }

      drawPlayer();

      coins.forEach(coin => coin.x -= gameSpeed);
      obstacles.forEach(obs => obs.x -= gameSpeed);

      drawCoins();
      drawObstacles();
      checkCollisions();

      coins = coins.filter(c => c.x > -20);
      obstacles = obstacles.filter(o => o.x > -60);

      frameCount++;
      if (frameCount % 100 === 0) {
        let coinY = canvas.height - groundHeight - (Math.random() * 60 + 40);
        coins.push({x: canvas.width + 20, y: coinY, radius: 10, collected: false});
      }

      if (frameCount % 150 === 0) {
        let type = Math.random() > 0.5 ? "spike" : "platform";
        if (type === "spike") {
          let obsHeight = Math.random() * 15 + 15; 
          obstacles.push({
            type: "spike",
            x: canvas.width + 50,
            y: canvas.height - groundHeight - obsHeight,
            width: 15, 
            height: obsHeight
          });
        } else {
          let platHeight = 20;
          let platY = canvas.height - groundHeight - (Math.random() * 80 + 60);
          obstacles.push({
            type: "platform",
            x: canvas.width + 70,
            y: platY,
            width: 60,
            height: platHeight
          });
        }
      }

      if(gameStarted) requestAnimationFrame(update);
    }

    updateHP();

    function jump() {
      if (player.grounded) {
        player.dy = player.jumpPower;
        player.grounded = false;
        jumpSound.currentTime = 0;
        jumpSound.play();
      }
    }

    // üéÆ Play tugmasi ishlashi
    document.getElementById('start-btn').addEventListener('click', () => {
      gameStarted = true;
      document.getElementById('startScreen').style.display = 'none';
      canvas.style.display = 'block';
      document.getElementById('controls').style.display = 'block';
      bgMusic.play();
      update(); // o'yinni boshlash
    
    let selectedCharacter = null;

    function selectedCharacter(imgUrl) {
      selectedCharacter = imgUrl;
      document.queryselectorall('#characters img').forEach(img => img.style.border = 'none');
      event.target.style.border = '3px solid blue';
    }

    document.getElementById('start-btn').addEventListener('click', () => {
      if (!selectedCharacter) {
        alert("Iltimos, qahramon tanlang!");
        return;
      }
      document.getElementById('characterSelect').style.display = 'none';
      document.getElementById('gameCanvas').style.display = 'block';

      playerImg.src = selectedCharacter;
      bgmusic.play();
      update();
    });  
  </script>
</body>
</html>
